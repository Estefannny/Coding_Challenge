@{
    ViewBag.Title = "Coding Challenge";
}

<html>
<body>
    <h2>Coding Challenge GreenSlate.</h2>
    <div style="width:90%; margin:0 auto">
        @* Search Area *@
        <div style="background-color:#f5f5f5; padding:20px">
            <h2>Search Projects for User</h2>
            <select id="idUserName" style="width:300px">
                <option>--</option>
            </select>

        </div>
        @* jQuery DataTables *@
        <div>
            <table id="tableProjects" class="table table-hover table-bordered" width="100%" cellspacing="0">
                <thead>
                    <tr>
                    <tr>
                        <th>ProjectId</th>
                        <th>StartDate</th>
                        <th>TimeToStart</th>
                        <th>EndDate</th>
                        <th>Credits</th>
                        <th>Status</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</body>
</html>


@section Scripts{
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!--Import jQuery before export.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <!--Data Table-->
    <script type="text/javascript" src=" https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src=" https://cdn.datatables.net/buttons/1.2.4/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script>
    <!--Export table buttons-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.24/build/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.24/build/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.2.4/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.2.1/js/buttons.print.min.js"></script>

    <script>
        $(document).ready(function () {
            $.ajax({
                url: "/Home/getUsers",
                dataSrc: "",
                datatype: "JSON",
                type: "GET",
                success: function (data) {
                    var s = '<option value="-1">Please Select a User Name --</option>';
                    for (var i = 0; i < data.length; i++) {
                        s += '<option value="' + data[i].Id + '">' + data[i].FirstName + '</option>';
                        console.log(data[i]);
                    }
                    $("#idUserName").html(s);
                }
            });
        });

        $(document).ready(function () {
            $('#idUserName').change(function () {
                var idUser = $('#idUserName').val();
                updateTableProjects(idUser);
            });
        });

        function updateTableProjects(idUser) {
            $('#tableProjects').dataTable().fnClearTable();
            $('#tableProjects').dataTable().fnDraw();
            $('#tableProjects').dataTable().fnDestroy();
            $('#tableProjects').dataTable({          
                destroy:true,
                retrieve: true,
                paging: false,
                searching: false,
                processing: true, 
                serverSide: true, 
                filter: true, 
                orderMulti: false, 
                ajax: {
                    url: "/Home/DetailsUserProjects/"+idUser,
                    dataSrc: "",
                    type: "GET",
                    datatype: "json",
                },
                columns: [
                    { "data": "ProjectId" },
                    {"data":"StartDate"},
                    //{
                    //    "data": "StartDate", "render": function (date) {
                    //        var date = new Date(parseInt(date.substr(6)));
                    //        var month = date.getMonth() + 1;
                    //        return date.getDate() + "/" + month + "/" + date.getFullYear();
                    //    }
                    //},
                    { "data": "TimeToStart" },
                    {"data":"EndDate"},
                    //{
                    //    "data": "EndDate", "render": function (date) {
                    //        var date = new Date(parseInt(date.substr(6)));
                    //        var month = date.getMonth() + 1;
                    //        return date.getDate() + "/" + month + "/" + date.getFullYear();
                    //    }
                    //},
                    { "data": "Credits" },
                    {"data":"Status"}
                ]
            });
        }

    </script>

}


